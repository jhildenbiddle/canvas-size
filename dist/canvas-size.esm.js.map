{"version":3,"file":"canvas-size.esm.js","sources":["../src/canvas-test.js","../src/test-sizes.js","../src/index.js"],"sourcesContent":["/* eslint-env browser, worker */\n\n/**\n * Tests ability to read pixel data from canvas elements of various dimensions\n * by decreasing canvas height and/or width until a test succeeds.\n *\n * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n * IMPORTANT: DO NOT USE ES6 CODE THAT REQUIRES BABEL HELPERS IN THIS FILE.\n *            This function will be used on the main thread and as part of an\n *            inline web worker, but access to Babel helpers will be available\n *            only on the main thread.\n * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n *\n * @param {object} settings\n * @param {number[][]} settings.sizes\n * @param {function} settings.onError\n * @param {function} settings.onSuccess\n */\nfunction canvasTest(settings) {\n    const size     = settings.sizes.shift();\n    const width    = Math.max(Math.ceil(size[0]), 1);\n    const height   = Math.max(Math.ceil(size[1]), 1);\n    const fill     = [width - 1, height - 1, 1, 1]; // x, y, width, height\n    const job      = Date.now();\n    const isWorker = typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope;\n\n    let cropCvs, testCvs;\n\n    if (isWorker) {\n        cropCvs = new OffscreenCanvas(1, 1);\n        testCvs = new OffscreenCanvas(width, height);\n    }\n    else {\n        cropCvs = document.createElement('canvas');\n        cropCvs.width = 1;\n        cropCvs.height = 1;\n        testCvs = document.createElement('canvas');\n        testCvs.width = width;\n        testCvs.height = height;\n    }\n\n    const cropCtx = cropCvs.getContext('2d');\n    const testCtx = testCvs.getContext('2d');\n\n    if (testCtx) {\n        testCtx.fillRect.apply(testCtx, fill);\n\n        // Render the test pixel in the bottom-right corner of the\n        // test canvas in the top-left of the 1x1 crop canvas. This\n        // dramatically reducing the time for getImageData to complete.\n        cropCtx.drawImage(testCvs, width - 1, height - 1, 1, 1, 0, 0, 1, 1);\n    }\n\n    // Verify image data (Pass = 255, Fail = 0)\n    const isTestPass = cropCtx && cropCtx.getImageData(0, 0, 1, 1).data[3] !== 0;\n    const benchmark  = Date.now() - job; // milliseconds\n\n    // Release canvas elements (Safari memory usage fix)\n    // See: https://stackoverflow.com/questions/52532614/total-canvas-memory-use-exceeds-the-maximum-limit-safari-12\n    [cropCvs, testCvs].forEach(cvs => {\n        cvs.height = 0;\n        cvs.width = 0;\n    });\n\n    // Running in a web worker\n    if (isWorker) {\n        postMessage({\n            width,\n            height,\n            benchmark,\n            isTestPass\n        });\n\n        if (!isTestPass && settings.sizes.length) {\n            canvasTest(settings);\n        }\n    }\n    else if (isTestPass) {\n        settings.onSuccess(width, height, benchmark);\n    }\n    else {\n        settings.onError(width, height, benchmark);\n\n        if (settings.sizes.length) {\n            canvasTest(settings);\n        }\n    }\n\n    return isTestPass;\n}\n\nexport default canvasTest;\n","const testSizes = {\n    area: [\n        // Chrome 70 (Mac, Win)\n        // Chrome 68 (Android 4.4)\n        // Edge 17 (Win)\n        // Safari 7-12 (Mac)\n        16384,\n        // Chrome 68 (Android 7.1-9)\n        14188,\n        // Chrome 68 (Android 5)\n        11402,\n        // Firefox 63 (Mac, Win)\n        11180,\n        // Chrome 68 (Android 6)\n        10836,\n        // IE 9-11 (Win)\n        8192,\n        // IE Mobile (Windows Phone 8.x)\n        // Safari (iOS 9 - 12)\n        4096,\n        // Failed\n        1\n    ],\n    height: [\n        // Safari 7-12 (Mac)\n        // Safari (iOS 9-12)\n        8388607,\n        // Chrome 83 (Mac, Win)\n        65535,\n        // Chrome 70 (Mac, Win)\n        // Chrome 68 (Android 4.4-9)\n        // Firefox 63 (Mac, Win)\n        32767,\n        // Edge 17 (Win)\n        // IE11 (Win)\n        16384,\n        // IE 9-10 (Win)\n        8192,\n        // IE Mobile (Windows Phone 8.x)\n        4096,\n        // Failed\n        1\n    ],\n    width: [\n        // Safari 7-12 (Mac)\n        // Safari (iOS 9-12)\n        4194303,\n        // Chrome 83 (Mac, Win)\n        65535,\n        // Chrome 70 (Mac, Win)\n        // Chrome 68 (Android 4.4-9)\n        // Firefox 63 (Mac, Win)\n        32767,\n        // Edge 17 (Win)\n        // IE11 (Win)\n        16384,\n        // IE 9-10 (Win)\n        8192,\n        // IE Mobile (Windows Phone 8.x)\n        4096,\n        // Failed\n        1\n    ]\n};\n\nexport default testSizes;","import canvasTest from './canvas-test';\nimport testSizes from './test-sizes';\n\n\n// Constants & Variables\n// =============================================================================\nconst defaults = {\n    max       : null,\n    min       : 1,\n    sizes     : [],\n    step      : 1024,\n    usePromise: false,\n    useWorker : false,\n    // Callbacks\n    onError   : Function.prototype,\n    onSuccess : Function.prototype\n};\nconst workerJobs = {\n    // jobID: {\n    //     onError: fn(),\n    //     onSuccess: fn()\n    // }\n};\n\n\n// Functions (Private)\n// =============================================================================\n/**\n * Creates a 2d array of canvas dimensions either from the default testSizes\n * object or the width/height/min/step values provided.\n *\n * @param   {object} settings\n * @param   {number} settings.width\n * @param   {number} settings.height\n * @param   {number} settings.min\n * @param   {number} settings.step\n * @param   {number[][]} settings.sizes\n * @returns {number[][]}\n */\nfunction createSizesArray(settings) {\n    const isArea   = settings.width === settings.height;\n    const isWidth  = settings.height === 1;\n    const isHeight = settings.width === 1;\n    const sizes    = [];\n\n    // Use settings.sizes\n    if (!settings.width || !settings.height) {\n        settings.sizes.forEach(testSize => {\n            const width  = isArea || isWidth ? testSize : 1;\n            const height = isArea || isHeight ? testSize : 1;\n\n            sizes.push([width, height]);\n        });\n    }\n    // Generate sizes from width, height, and step\n    else {\n        const testMin  = settings.min || defaults.min;\n        const testStep = settings.step || defaults.step;\n        let   testSize = Math.max(settings.width, settings.height);\n\n        while (testSize >= testMin) {\n            const width  = isArea || isWidth ? testSize : 1;\n            const height = isArea || isHeight ? testSize : 1;\n\n            sizes.push([width, height]);\n            testSize -= testStep;\n        }\n    }\n\n    return sizes;\n}\n\n/**\n * Handles calls from maxArea(), maxHeight(), maxWidth(), and test() methods.\n *\n * @param {object} settings\n * @param {number[][]} settings.sizes\n * @param {function} settings.onError\n * @param {function} settings.onSuccess\n */\nfunction handleMethod(settings) {\n    const hasCanvasSupport          = window && 'HTMLCanvasElement' in window;\n    const hasOffscreenCanvasSupport = window && 'OffscreenCanvas' in window;\n    const jobID                     = Date.now();\n    const { onError, onSuccess, ...settingsWithoutCallbacks } = settings;\n\n    let worker  = null;\n\n    /* istanbul ignore if */\n    if (!hasCanvasSupport) {\n        return false;\n    }\n\n    // Create web worker\n    if (settings.useWorker && hasOffscreenCanvasSupport) {\n        const js = `\n            var canvasTest = ${canvasTest.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `;\n        const blob    = new Blob([js], { type: 'application/javascript' });\n        const blobURL = URL.createObjectURL(blob);\n\n        worker = new Worker(blobURL);\n        URL.revokeObjectURL(blobURL);\n\n        // Listen for messages from worker\n        worker.onmessage = function(e) {\n            const { width, height, benchmark, isTestPass } = e.data;\n\n            if (isTestPass) {\n                workerJobs[jobID].onSuccess(width, height, benchmark);\n\n                delete workerJobs[jobID];\n            }\n            else {\n                workerJobs[jobID].onError(width, height, benchmark);\n            }\n        };\n    }\n\n    // Promise\n    if (settings.usePromise) {\n        return new Promise((resolve, reject) => {\n            const promiseSettings = {\n                ...settings,\n                onError(width, height, benchmark) {\n                    let isLastTest;\n\n                    // If running on the main thread, an empty settings.sizes\n                    // array indicates the last test.\n                    if (settings.sizes.length === 0) {\n                        isLastTest = true;\n                    }\n                    // If running in a web worker, the settings.sizes array\n                    // accessible to this callback wil not be modified because a\n                    // copy of the settings object is sent to the worker.\n                    // Therefore, a comparison of the width and height returned\n                    // to this callback and the last [width, height] item in the\n                    // settings.sizes array is used to determine the last test.\n                    else {\n                        const [[lastWidth, lastHeight]] = settings.sizes.slice(-1);\n                        isLastTest = width === lastWidth && height === lastHeight;\n                    }\n\n                    onError(width, height, benchmark);\n\n                    if (isLastTest) {\n                        reject({ width, height, benchmark });\n                    }\n                },\n                onSuccess(width, height, benchmark) {\n                    onSuccess(width, height, benchmark);\n                    resolve({ width, height, benchmark });\n                }\n            };\n\n            if (worker) {\n                const { onError, onSuccess } = promiseSettings;\n\n                // Store callbacks in workerJobs object\n                workerJobs[jobID] = { onError, onSuccess };\n\n                // Send message to work\n                worker.postMessage(settingsWithoutCallbacks);\n            }\n            else {\n                canvasTest(promiseSettings);\n            }\n        });\n    }\n    // Standard Callbacks\n    else {\n        if (worker) {\n            // Store callbacks in workerJobs object\n            workerJobs[jobID] = { onError, onSuccess };\n\n            // Send message to worker\n            worker.postMessage(settingsWithoutCallbacks);\n        }\n        else {\n            return canvasTest(settings);\n        }\n    }\n}\n\n\n// Methods\n// =============================================================================\nconst canvasSize = {\n    /**\n     * Determines maximum area of an HTML canvas element. When `max` is\n     * unspecified, an optimized test will be performed using known maximum\n     * values from a variety of browsers and platforms.\n     *\n     * @param {object} [options]\n     * @param {number} [options.max]\n     * @param {number} [options.min=1]\n     * @param {number} [options.step=1024]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxArea(options = {}) {\n        const sizes = createSizesArray({\n            width : options.max,\n            height: options.max,\n            min   : options.min,\n            step  : options.step,\n            sizes : [...testSizes.area]\n        });\n        const settings = { ...defaults, ...options, sizes };\n\n        return handleMethod(settings);\n    },\n\n    /**\n     * Determines maximum height of an HTML canvas element. When `max` is\n     * unspecified, an optimized test will be performed using known maximum\n     * values from a variety of browsers and platforms.\n     *\n     * @param {object} [options]\n     * @param {number} [options.max]\n     * @param {number} [options.min=1]\n     * @param {number} [options.step=1024]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxHeight(options = {}) {\n        const sizes = createSizesArray({\n            width : 1,\n            height: options.max,\n            min   : options.min,\n            step  : options.step,\n            sizes : [...testSizes.height]\n        });\n        const settings = { ...defaults, ...options, sizes };\n\n        return handleMethod(settings);\n    },\n\n    /**\n     * Determines maximum width of an HTML canvas element. When `max` is\n     * unspecified, an optimized test will be performed using known maximum\n     * values from a variety of browsers and platforms.\n     *\n     * @param {object} [options]\n     * @param {number} [options.max]\n     * @param {number} [options.min=1]\n     * @param {number} [options.step=1024]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxWidth(options = {}) {\n        const sizes = createSizesArray({\n            width : options.max,\n            height: 1,\n            min   : options.min,\n            step  : options.step,\n            sizes : [...testSizes.width]\n        });\n        const settings = { ...defaults, ...options, sizes };\n\n        return handleMethod(settings);\n    },\n\n    /**\n     * Tests ability to read pixel data from canvas of specified dimension(s).\n     *\n     * @param {object} [options]\n     * @param {number} [options.width]\n     * @param {number} [options.height]\n     * @param {number[][]} [options.sizes]\n     * @param {boolean} [options.usePromise=false]\n     * @param {boolean} [options.useWorker=false]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    test(options = {}) {\n        const settings = { ...defaults, ...options };\n\n        // Prevent mutation of sizes array\n        settings.sizes = [...settings.sizes];\n\n        if (settings.width && settings.height) {\n            settings.sizes = [[settings.width, settings.height]];\n        }\n\n        return handleMethod(settings);\n    }\n};\n\n\n// Exports\n// =============================================================================\nexport default canvasSize;"],"names":["canvasTest","settings","size","sizes","shift","width","Math","max","ceil","height","fill","job","Date","now","isWorker","WorkerGlobalScope","self","cropCvs","testCvs","OffscreenCanvas","document","createElement","cropCtx","getContext","testCtx","fillRect","apply","drawImage","isTestPass","getImageData","data","benchmark","forEach","cvs","postMessage","length","onSuccess","onError","testSizes","area","defaults","min","step","usePromise","useWorker","Function","prototype","workerJobs","createSizesArray","isArea","isWidth","isHeight","testSize","push","testMin","testStep","handleMethod","hasCanvasSupport","window","hasOffscreenCanvasSupport","jobID","settingsWithoutCallbacks","_objectWithoutProperties","_excluded","worker","js","concat","toString","blob","Blob","type","blobURL","URL","createObjectURL","Worker","revokeObjectURL","onmessage","e","_e$data","Promise","resolve","reject","promiseSettings","_objectSpread","isLastTest","_settings$sizes$slice","slice","_settings$sizes$slice2","_slicedToArray","_settings$sizes$slice3","lastWidth","lastHeight","canvasSize","maxArea","options","arguments","undefined","_toConsumableArray","maxHeight","maxWidth","test"],"mappings":"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"}